---
title: "lab03"
author: "Kate Patrakova"
date: '22 октября 2017 г '
output: html_document
---
#Лабораторная работа 3
Файл _forbes.htm_ содержит список богатейших американцев по версии журнала Форбс.
На его примере потренируемся в разборе html страниц.

### Задание 1
1. Используйте команду ``readLines`` для загрузки файла в текстовый вектор _html_.
```{r}
forbes<-readLines("forbes.htm" )
```
   1. Сколько строк в файле?
   2. Сколько символов в файле?
```{r}
length(forbes)
sum(nchar(forbes))
```
В файле 1991 строка и 80380 символов.

2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.
Билл Гейтс 72B$ первый в списке 
Ларри Эллисон 41B$ третий в списке

3. Напишите шаблон регулярного выражения и используйте функцию ``grep``, чтобы извлечь размер дохода из данных в векторе _html_.
Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в котрых действительно есть
информация о доходе, а не просто первый попавшийся текст.
```{r}
str.num<-grep(pattern="[$](\\d+,*\\d*) B" ,forbes)
forbes[str.num]
length(str.num)
```

4. Напишите код, использовав регулярное выражение из п. 3, и функции ``regexp`` и ``regmatches``, чтобы извлечь все данные о доходе.
Проверьте следующее:
   1. Должно быть ровно сто значений.
   2. Самый большой доход должен быть доход Билла Гейтса
   3. Такой доход должен быть в списке один раз.
   4. В всписке должна быть цифра, которую мы запомнили для Ларри Эллисона.
   5. Должно быть как минимум два значения, встречающихся несколько раз.
   
```{r}
worths.str<-regmatches(forbes, regexpr("[$](\\d+,*\\d*) B", forbes))
#1
length(worths.str)
#2
worths.str[1]
#3
length(worths.str[worths.str=="$72 B"])
#4
worths.str[3]
#5
length(worths.str[worths.str=="$4,6 B"])
```

### Задание 2
5. В данных доход представлен в формате **"$42 B"**, что означает **42 ?? 10^9**.
Преобразуйте этот формат в числовой и сохраните в вектор _worths_. Удостоверьтесь в следующем:
   1. _worths_ является вектором и в нём сто занчений типа _double_.
   2. Все элементы вектора _worths_ больше 1 миллиарда.
   3. Самое большое число это доход Билла Гейтса.

```{r}
worths<-as.numeric(sub(",",".", regmatches(worths.str, regexpr('(\\d+,*\\d*)',worths.str))))*10**9 
worths

#Проверки
#1
length(worths)
typeof(worths)
#2 
min(worths)
worths>10**9
#3 
worths[which(worths==max(worths))]
```

Проверка показала, что самый богатый это первый человек в списке с доходом 72 милларда. Билл Гейтс первый в списке и его доход 72 миллирда (пункт 1.2) и истина проверка на единственность (пункт 1.3), следовательно у Билла Гейтса самый большой доход в 2013.

6. Используйте вектор _worths_ , чтобы выяснить следующее:
   1. Какова медиана ста этих записей?
```{r}
median(worths)
```

   2. Средний доход?
```{r}
mean(worths)
```

   3. Как много людей из этого списка имеют доход больше 5млрд., 10, 25?
```{r}
length(worths[worths>5*10**9])
length(worths[worths>10*10**9])
length(worths[worths>25*10**9])
```

   1. Какой их общий доход?
   2. Какую долю от общего дохода, составляет пятёрка самых богатых.
   3. Какую долю от общего дохода, составляют 20 самых богатых.
   
```{r}
sum(worths)
sum(worths[c(1:5)])/sum(worths)
sum(worths[c(1:20)])/sum(worths)
```

   4. В данных [федерального резерва США](https://www.federalreserve.gov/releases/z1/current/z1.pdf) найдите
   показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю
   общего дохода составляют 100 богатейших людей. 
   
   
```{r}
Household.net.worth.2013 <- 78.909*10**9
Household.net.worth.2013/sum(worths)
```

